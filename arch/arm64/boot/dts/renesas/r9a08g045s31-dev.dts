// SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
/*
 * Device Tree Source for the RZ/G3S Development board (13mm_LPDDR4)
 *
 * Copyright (C) 2023 Renesas Electronics Corp.
 */

/dts-v1/;
#include "r9a08g045.dtsi"
#include "rzg3s-dev-common.dtsi"
#include "rzg3s-dev-pinfunction.dtsi"

/*
 * Select between USB2 phy0 and MTU3 pins which are multiplexed
 * MTU3 pins are NOT required, if only use clocksource/clockevent
 * functions.
 */
#define MTU3_PINS_SEL			0

/*
 * RSPI2_PINS_SEL - select between RSPI ch2 and POE3, POEG, GPT pins
 * RSPI2_LOOPBACK_SEL - select target SPI device
 * 			(N25Q256A flash with Digilent PMOD SF3 by default)
 */
#define RSPI2_PINS_SEL			1
#define RSPI2_LOOPBACK_SEL		0

/ {
	model = "Renesas Development EVK based on r9a08g045s31 SoC";
	compatible = "renesas,r9a08g045",
		     "renesas,r9a08g045s31",
		     "renesas,r9a08g045s31-dev";
};

#if !MTU3_PINS_SEL
&usb2_phy0 {
	pinctrl-0 = <&usb0_pins>;
	pinctrl-names = "default";

	vbus-supply = <&vbus0_usb2>;
	status = "okay";
};
#else
&mtu3 {
	pinctrl-0 = <&mtu3_pins>;
	pinctrl-names = "default";
	pwm_complementary = <7 0>;
};
#endif

#if !RSPI2_SEL
&poe3 {
	pinctrl-0 = <&poe3_pins>;
	pinctrl-names = "default";
	poe3_pins_mode = <0 0>, <4 0>;
	status = "okay";
	mtu3_ch67 {
		mtu3_outputs = <1>;
		addition_poe3_inputs = <0 4>;
	};
};

&poegc {
	pinctrl-0 = <&poegc_pins>;
	pinctrl-names = "default";
	status = "okay";
};

&poegd {
	pinctrl-0 = <&poegd_pins>;
	pinctrl-names = "default";
	status = "okay";
};
#else
&spi2 {
	pinctrl-0 = <&spi2_pins>;
	pinctrl-names = "default";

	dmas = <&dmac 0x2ee1>, <&dmac 0x2ee2>;
	dma-names = "tx", "rx";

	status = "okay";

#if RSPI2_LOOPBACK_SEL
	spidev@0 {
		compatible = "rohm,dh2228fv";
		reg = <0>;
		spi-max-frequency = <50000000>;
	};
#else
	flash0: n25q256a@0 {
		compatible = "micron,n25q256a", "jedec,spi-nor";
		reg = <0>;
		spi-max-frequency = <10000000>;
		spi-tx-bus-width = <1>;
		spi-rx-bus-width = <1>;
		m25p,fast-read;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			scratch@0 {
				reg = <0x00000000 0x2000000>;
			};
		};
	};
#endif /* RSPI2_LOOPBACK_SEL */
};
#endif /* !RSPI2_SEL */

&gpt0 {
	pinctrl-0 = <&gpt0_pins>;
	pinctrl-names = "default";
	channel = "both_AB";
	poeg = <&poegc &poegd>;
	status = "okay";
};
